# 微服务架构Wiki示例

本文档提供微服务架构项目的Wiki目录结构和文档模板。

---

## 推荐目录结构

```
docs/
├── README.md                          # Wiki首页
├── 01-整体架构/
│   ├── 01-技术栈说明.md               # 技术栈详细说明
│   ├── 02-系统架构说明.md             # 微服务整体架构图
│   ├── 03-业务架构说明.md             # 业务域划分【重点】
│   ├── 04-核心流程说明.md             # 跨服务核心业务流程【新增】
│   ├── 05-服务拆分说明.md             # 服务边界、拆分原则
│   ├── 06-服务通信说明.md             # RPC/HTTP/MQ
│   └── 07-部署拓扑说明.md             # 部署架构图
├── 02-基础设施/
│   ├── 01-网关服务.md                 # Gateway/Zuul
│   ├── 02-注册中心.md                 # Nacos/Eureka
│   ├── 03-配置中心.md                 # Nacos/Apollo
│   ├── 04-链路追踪.md                 # Skywalking/Zipkin
│   └── 05-监控告警.md                 # Prometheus/Grafana
├── 03-业务服务/
│   ├── 01-[服务A].md                  # 每个微服务一个文档（含核心流程）
│   ├── 02-[服务B].md
│   └── ...
├── 04-公共模块/
│   ├── 01-公共组件.md                 # common模块
│   └── 02-SDK说明.md                  # 对外SDK
├── 05-数据库设计/
│   ├── 01-数据库概述.md               # 分库策略
│   ├── 02-全局ER图总览.md             # 跨服务核心表关联【新增】
│   ├── 03-[服务A]ER图.md              # 每个服务的完整ER图【新增】
│   ├── 04-[服务B]ER图.md              # 每个服务的完整ER图【新增】
│   ├── 05-全局表索引.md               # 所有表清单（确保无遗漏）【新增】
│   └── ...
├── 06-开发规范/
│   ├── 01-代码规范.md
│   ├── 02-命名规范.md
│   ├── 03-分层规范.md
│   └── 04-API规范.md
├── 07-部署运维/
│   ├── 01-本地开发环境.md
│   ├── 02-Docker部署.md
│   ├── 03-K8s部署.md
│   └── 04-CI-CD流程.md
└── 08-附录/
    ├── 01-术语表.md                   【重点】
    └── 02-常见问题.md
```

---

## 微服务架构图模板

```mermaid
graph TB
    subgraph 接入层["接入层"]
        LB[负载均衡]
        Gateway[API网关]
    end
    
    subgraph 业务服务层["业务服务层"]
        S1[服务A]
        S2[服务B]
        S3[服务C]
    end
    
    subgraph 基础设施层["基础设施层"]
        Registry[注册中心]
        Config[配置中心]
        MQ[消息队列]
    end
    
    subgraph 数据层["数据层"]
        DB1[(数据库A)]
        DB2[(数据库B)]
        Cache[(缓存)]
    end
    
    LB --> Gateway
    Gateway --> S1 & S2 & S3
    S1 & S2 & S3 --> Registry
    S1 & S2 & S3 --> Config
    S1 --> DB1
    S2 --> DB2
    S3 --> Cache
    S1 <--> MQ <--> S2
```

---

## 服务拆分说明模板

```markdown
# 服务拆分说明

## 拆分原则

- 按业务领域拆分
- 按团队职责拆分
- 按变更频率拆分

## 服务清单

| 服务名 | 职责 | 端口 | 数据库 | 依赖服务 |
|-------|------|-----|-------|---------|
| gateway | API网关 | 8080 | - | - |
| service-user | 用户服务 | 8001 | db_user | - |
| service-order | 订单服务 | 8002 | db_order | service-user |
| service-pay | 支付服务 | 8003 | db_pay | service-order |

## 服务依赖关系

[Mermaid graph展示服务依赖]

## 服务边界

### 服务A
- **职责范围**：[做什么]
- **不负责**：[不做什么]
- **对外接口**：[提供什么接口]
- **依赖接口**：[调用什么接口]
```

---

## 服务通信说明模板

```markdown
# 服务通信说明

## 通信方式

| 场景 | 方式 | 协议 | 说明 |
|-----|------|------|------|
| 同步调用 | Feign/Dubbo | HTTP/RPC | 需要立即返回结果 |
| 异步通知 | RabbitMQ/Kafka | AMQP | 不需要立即返回 |
| 事件广播 | MQ | - | 一对多通知 |

## 核心接口契约

### 服务A -> 服务B

| 接口 | 方法 | 说明 |
|-----|------|------|
| /api/user/{id} | GET | 获取用户信息 |

## 消息定义

| Topic/Queue | 生产者 | 消费者 | 消息体 |
|------------|-------|-------|-------|
| order.created | 订单服务 | 支付服务 | OrderCreatedEvent |
```

---

## 基础设施文档模板

```markdown
# [基础设施名称]

## 概述

[组件作用说明]

## 技术选型

| 组件 | 版本 | 说明 |
|-----|------|------|

## 配置说明

[核心配置项]

## 使用方式

[如何接入、如何使用]

## 运维要点

[启动命令、健康检查、常见问题]
```

---

## 业务服务文档模板

```markdown
# [服务名称]

## 服务概述

| 项目 | 说明 |
|-----|------|
| 服务名称 | xxx-service |
| 端口 | 8001 |
| 数据库 | db_xxx |
| 职责 | [做什么] |

## 核心流程识别

> 该服务的核心业务流程

| 流程名称 | 重要性 | 跨服务调用 | 触发场景 |
|---------|-------|-----------|---------|
| [流程1] | ⭐⭐⭐ | 是/否 | [何时触发] |
| [流程2] | ⭐⭐ | 是/否 | [何时触发] |

## 核心流程详解

### 流程一：[流程名称]

**业务目的**：[解决什么问题]

**流程图**：
[Mermaid flowchart/sequenceDiagram]

**跨服务调用**：

| 步骤 | 调用服务 | 接口 | 说明 |
|-----|---------|-----|------|
| [步骤1] | service-xxx | /api/xxx | [做什么] |

**关键节点**：

| 节点 | 说明 | 代码位置 |
|-----|------|---------|
| [节点1] | [做什么] | `XxxService.method()` |

## 模块结构

[服务内部模块划分]

## 对外接口

| 接口 | 方法 | 说明 |
|-----|------|------|

## 依赖服务

| 服务 | 接口 | 用途 |
|-----|------|------|

## 消息订阅

| Topic/Queue | 用途 |
|------------|------|

## 数据库表

| 表名 | 说明 |
|-----|------|
```

---

## 完整ER图模板（微服务架构）

```markdown
# 全局ER图总览

> 展示跨服务的核心表关联关系

[Mermaid erDiagram：各服务核心表及跨服务关联]

---

# [服务A]ER图

> 包含服务A的所有表及其关系

[Mermaid erDiagram：服务A所有表]

---

# 全局表索引（确保无遗漏）

| 序号 | 表名 | 所属服务 | 所属数据库 | 对应ER图 | 说明 |
|-----|------|---------|-----------|---------|------|
| 1 | user | 用户服务 | db_user | 用户服务 ER图 | [用途] |
| 2 | order | 订单服务 | db_order | 订单服务 ER图 | [用途] |
| ... | ... | ... | ... | ... | ... |

**统计**：共计 N 张表，分布在 M 个数据库，全部已纳入ER图

## 跨服务表关联说明

| 服务A表 | 关联字段 | 服务B表 | 关联字段 | 关联说明 |
|--------|---------|--------|---------|---------|
| order | user_id | user | id | 订单关联用户 |

## 检查清单

- [ ] 所有服务的表都已列入表索引
- [ ] 每张表都在对应服务的ER图中
- [ ] 跨服务的表关联关系已说明
- [ ] 分库策略已在数据库概述中说明
```

---

## 部署文档模板

```markdown
# Docker部署

## 镜像构建

docker build -t xxx-service:latest .

## Docker Compose

[docker-compose.yml示例]

---

# K8s部署

## Deployment

[deployment.yaml示例]

## Service

[service.yaml示例]

## ConfigMap

[configmap.yaml示例]
```
